%html
	%head
		%title Game
		%script{:type => "text/javascript", :src => "/javascripts/jquery-1.6.2.min.js"}
		%script{:type => "text/javascript", :src => "/javascripts/EventSource.js"}
		%script{:type => "text/javascript", :src => "/javascripts/helpers.js"}
		%script{:type => "text/javascript", :src => "/javascripts/horus_api.js"}
		:javascript

			function currentGameId() {
				return $.currentUrlParam('game_id');
			};

			function onAddTile() {
				var tile = $('input#tile').val();
				addTile(currentGameId(), tile);
				$('#tile').val('');
			};
			
			function updatePlayers(nicks) {
				$('#players').html(nicks.join("<br/>"))
			};
			
			$(document).ready(function() {
				$('#tile').bind('keypress', function(e) {
				        if (e.which == 13)
							onAddTile();
				});
			
				$('#add').bind('click', function() {
					onAddTile();
				});

				var players = [];
				receiveGameEvents(currentGameId(), 
					function(tile) {
						$('#board').append(tile + ' ');
					},
					function(join) {
						players.push(join);
						updatePlayers(players);
					});
				
				$('#tile').focus();
			});
			
		%style{:type => "text/css", :media => "screen"}
			:plain
				#board {
					border: 1px solid green;
					padding: 10px;
					margin-bottom: 10px;
				}
				#add {
					height: 25px;
				}
				#tile {
					height: 25px;
				}
				#players {
					margin-top: 20px;
				}
		-unless @interactive # Visitor may only watch the game.
			%style{:type => "text/css", :media => "screen"}
				:plain
					#controls {
						display: none;
					}
					
			
	%body
		#game
			#board
			#controls
				%span Type a word:
				%input{:id => "tile", :name => "tile", :type => "text"}
				%button{:id => "add", :name => "add"}Add to board
		#players